<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>About the matchmaps algorithm &mdash; matchmaps</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=e9b4edf4" />

  
    <link rel="shortcut icon" href="_static/rs-favicon_32x32.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=f8d11f8d"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="#" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="matchmaps command-line interface" href="cli.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            matchmaps
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-line options</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">About the algorithm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#excerpts-from-the-pre-print">Excerpts from the pre-print</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#abstract">Abstract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#algorithm-description">Algorithm description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#matchmaps-variants"><code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> variants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#matchmaps-mr"><code class="docutils literal notranslate"><span class="pre">matchmaps.mr</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#matchmaps-ncs"><code class="docutils literal notranslate"><span class="pre">matchmaps.ncs</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#questions-or-thoughts">Questions or thoughts?</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">matchmaps</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">About the <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> algorithm</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/about.md" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="about-the-matchmaps-algorithm">
<h1>About the <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> algorithm<a class="headerlink" href="#about-the-matchmaps-algorithm" title="Link to this heading"></a></h1>
<p>If you want to learn more about the idea behind <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code>, along with some examples, please check out our new pre-print!</p>
<blockquote>
<div><p><a class="reference external" href="https://www.biorxiv.org/content/10.1101/2023.09.01.555333v1">MatchMaps: Non-isomorphous difference maps for X-ray crystallography</a></p>
</div></blockquote>
<section id="excerpts-from-the-pre-print">
<h2>Excerpts from the pre-print<a class="headerlink" href="#excerpts-from-the-pre-print" title="Link to this heading"></a></h2>
<section id="abstract">
<h3>Abstract<a class="headerlink" href="#abstract" title="Link to this heading"></a></h3>
<p>Conformational change mediates the biological functions of proteins. Crystallographic measurements can map these changes with extraordinary sensitivity as a function of mutations, ligands, and time. The isomorphous difference map remains the gold standard for detecting structural differences between datasets. Isomorphous difference maps combine the phases of a chosen reference state with the observed changes in structure factor amplitudes to yield a map of changes in electron density. Such maps are much more sensitive to conformational change than structure refinement is, and are unbiased in the sense that observed differences do not depend on refinement of the perturbed state. However, even minute changes in unit cell dimensions can render isomorphous difference maps useless. This is unnecessary. Here we describe a generalized procedure for calculating observed difference maps that retains the high sensitivity to conformational change and avoids structure refinement of the perturbed state. We have implemented this procedure in an open-source python package, MatchMaps, that can be run in any software environment supporting PHENIX and CCP4. Through examples, we show that MatchMaps “rescues” observed difference electron density maps for near-isomorphous crystals, corrects artifacts in nominally isomorphous difference maps, and extends to detecting differences across copies within the asymmetric unit, or across altogether different crystal forms.</p>
</section>
<section id="algorithm-description">
<h3>Algorithm description<a class="headerlink" href="#algorithm-description" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Place both sets of structure factor amplitudes on a common scale using CCP4’s <code class="docutils literal notranslate"><span class="pre">SCALEIT</span></code> utility and truncate the data to the same resolution range.</p></li>
<li><p>Generate phases for each dataset via the <code class="docutils literal notranslate"><span class="pre">phenix.refine</span></code> program. For each dataset, the OFF starting model is used, and only rigid-body refinement is permitted to prevent the introduction of model bias.</p></li>
<li><p>Fourier-transform each set of complex structure factors into a real-space electron density map using the python packages <code class="docutils literal notranslate"><span class="pre">reciprocalspaceship</span></code> and <code class="docutils literal notranslate"><span class="pre">gemmi</span></code>.</p></li>
<li><p>Compute the translation and rotation necessary to overlay the two rigid-body refined models. Apply this translation-rotation to the ON real-space map such that it overlays with the OFF map. These computations are carried out using <code class="docutils literal notranslate"><span class="pre">gemmi</span></code>.</p></li>
<li><p>Place both real-space maps on a common scale.</p></li>
<li><p>Subtract real-space maps voxel-wise.</p></li>
<li><p>Apply a solvent mask to the final difference map.</p></li>
</ol>
</section>
</section>
<section id="matchmaps-variants">
<h2><code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> variants<a class="headerlink" href="#matchmaps-variants" title="Link to this heading"></a></h2>
<p>In addition to the core <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> utility, two additional command-line functions are available: <code class="docutils literal notranslate"><span class="pre">matchmaps.mr</span></code> and <code class="docutils literal notranslate"><span class="pre">matchmaps.ncs</span></code>. The algorithm is modified slightly for each utility.</p>
<section id="matchmaps-mr">
<h3><code class="docutils literal notranslate"><span class="pre">matchmaps.mr</span></code><a class="headerlink" href="#matchmaps-mr" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">matchmaps.mr</span></code> can support two input reflection files that are in different crystal packings or spacegroups. Accordingly, step 1 above is replaced with a round of molecular replacement (using <code class="docutils literal notranslate"><span class="pre">phenix.phaser</span></code>) whereing the OFF starting model is used as a molecular replacement solution for the ON reflections. The algorithm proceeds essentially identically from this point.</p>
<p>One small but important change in <code class="docutils literal notranslate"><span class="pre">matchmaps.mr</span></code> is that all ordered water molecules in the OFF starting model are discarded. This is important, as the ordered water molecules in one spacegroup/crystal packing are often not appropriate in a different spacegroup/crystal packing.</p>
</section>
<section id="matchmaps-ncs">
<h3><code class="docutils literal notranslate"><span class="pre">matchmaps.ncs</span></code><a class="headerlink" href="#matchmaps-ncs" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">matchmaps.ncs</span></code> creates internal difference maps across a non-crystallographic symmetry operation. This function requires a number of modifications to the core algorithm:</p>
<ul class="simple">
<li><p>Step 1 is omitted; there is only one input reflection file, so no scaling is necessary.</p></li>
<li><p>Step 2 is optional. If phases are not included, <code class="docutils literal notranslate"><span class="pre">phenix.refine</span></code> is run to generate phases. However, if phases are provided, they are used and refinement is skipped.</p></li>
<li><p>In step 4, there is only one rigid-body refined model. Alignment is performed on the two regions of the model related by NCS (e.g., two different protein chains).</p></li>
</ul>
</section>
</section>
<section id="questions-or-thoughts">
<h2>Questions or thoughts?<a class="headerlink" href="#questions-or-thoughts" title="Link to this heading"></a></h2>
<p>If you have any questions, thoughts, or suggestions regarding this algorithm and software, we would love to hear from you! The easiest way to get in touch is by <a class="reference external" href="https://github.com/rs-station/matchmaps/issues">opening an issue on GitHub</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cli.html" class="btn btn-neutral float-left" title="matchmaps command-line interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Dennis Brookner.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>