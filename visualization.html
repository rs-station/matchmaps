<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visualizing matchmaps results &mdash; matchmaps</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=e9b4edf4" />

  
    <link rel="shortcut icon" href="_static/rs-favicon_32x32.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=01ee4458"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="About the matchmaps algorithm" href="about.html" />
    <link rel="prev" title="matchmaps command-line interface" href="cli.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            matchmaps
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-line options</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Visualizing results</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#working-with-map-files-in-coot">Working with <code class="docutils literal notranslate"><span class="pre">.map</span></code> files in Coot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#periodic-boundary-conditions-in-coot">Periodic boundary conditions in Coot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-map-files-in-pymol">Working with <code class="docutils literal notranslate"><span class="pre">.map</span></code> files in PyMOL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#normalization">Normalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#symmetry-expansion">Symmetry expansion.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pymol-wiki-pages-for-the-commands-mentioned">PyMOL Wiki pages for the commands mentioned</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About the algorithm</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">matchmaps</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Visualizing <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> results</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/visualization.md" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="visualizing-matchmaps-results">
<h1>Visualizing <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> results<a class="headerlink" href="#visualizing-matchmaps-results" title="Link to this heading"></a></h1>
<p>Once you have run <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code>, you’ll probably want to visualize the results!</p>
<p>If you have experience with cryo-EM, you’re probably familiar with <code class="docutils literal notranslate"><span class="pre">.map</span></code>/<code class="docutils literal notranslate"><span class="pre">.CCP4</span></code>/<code class="docutils literal notranslate"><span class="pre">.mrc</span></code> real-space map files. But if you’re a crystallographer, you might not have worked with these at all! Crystallographers typically just open <code class="docutils literal notranslate"><span class="pre">.mtz</span></code> files directly in a software (like coot or PyMOL) that does the Fourier transform and computes the map “on the fly”. But here you are, working with <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code>, which by design produces real-space outputs. Below is a brief description of how to work with <code class="docutils literal notranslate"><span class="pre">.map</span></code> files in Coot and PyMOL, along with some quirks specific to <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> outputs.</p>
<section id="working-with-map-files-in-coot">
<h2>Working with <code class="docutils literal notranslate"><span class="pre">.map</span></code> files in Coot<a class="headerlink" href="#working-with-map-files-in-coot" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">.map</span></code> files should be opened in Coot via “File &gt; Open Map…”:</p>
<p><img alt="Open Map..." src="_images/openmap.png" /></p>
<p>If the map you are opening is a difference map, it is essential that you check the option “Is Difference Map” in the bottom left corner of the “Select Map…” dialog. If you don’t do this here, there is no way to do it later; you’ll have to close and reopen the map.</p>
<p><img alt="Is difference map" src="_images/isdifferencemap.png" /></p>
<p>Happy difference mapping! From here, working with a <code class="docutils literal notranslate"><span class="pre">.map</span></code> file should be no different than typical work in Coot with an <code class="docutils literal notranslate"><span class="pre">.mtz</span></code> file.</p>
<section id="periodic-boundary-conditions-in-coot">
<h3>Periodic boundary conditions in Coot<a class="headerlink" href="#periodic-boundary-conditions-in-coot" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> always produces outputs in spacegroup P1, and thus will sometimes produces outputs in P1 and with an orthorhombic unit cell. Unfortunately, Coot assumes that P1 orthorhombic <code class="docutils literal notranslate"><span class="pre">.map</span></code> files are cryo-EM maps, and thus does not render periodic boundary conditions! This is an issue, because often we wish to visualize parts of the protein model which lie outside of the unit cell. As a workaround, any P1 orthorhombic maps produced by <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> will artifically set <code class="docutils literal notranslate"><span class="pre">alpha=90.006</span></code>. This difference is imperceptible, but is enough to convince Coot that the map is crystallographic in origin. In all likelihood, a user of <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> will not need to deal with this issue directly. However, it is good to keep in mind in case you are ever working with a <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> output for another purpose downstream, or if a related bug arises. Of course, if your maps in Coot are ever abruptly ending at the edge of the unit cells, please <a class="reference external" href="https://github.com/rs-station/matchmaps/issues">file an issue on GitHub</a>.</p>
</section>
</section>
<section id="working-with-map-files-in-pymol">
<h2>Working with <code class="docutils literal notranslate"><span class="pre">.map</span></code> files in PyMOL<a class="headerlink" href="#working-with-map-files-in-pymol" title="Link to this heading"></a></h2>
<p>PyMOL is, for many crystallographers, the preferred software for producing figures. Unfortunately, PyMOL’s default behaviors around <code class="docutils literal notranslate"><span class="pre">.map</span></code> inputs can be counterintuitive and hard to work with. I will attempt here to briefly outline the key issues that you might encounter.</p>
<p>Loading a map into PyMOL is easy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="n">on_minus_off</span><span class="o">.</span><span class="n">map</span><span class="p">,</span> <span class="n">difference_map</span>
</pre></div>
</div>
<p>Then, you will use the <code class="docutils literal notranslate"><span class="pre">isomesh</span></code> command to visualize your map at a given contour, around a given selection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">isomesh</span> <span class="n">differencemesh_positive</span><span class="p">,</span> <span class="n">difference_map</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pdb</span> <span class="ow">and</span> <span class="n">resi</span> <span class="mi">20</span>
</pre></div>
</div>
<section id="normalization">
<h3>Normalization<a class="headerlink" href="#normalization" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> outputs are <strong>already normalized</strong>. This means that when looking at <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> outputs, the <code class="docutils literal notranslate"><span class="pre">normalize_ccp4_maps</span></code> option should always be set to <code class="docutils literal notranslate"><span class="pre">off</span></code>. If this option is turned on, then the map’s contour levels are likely to be very different from, say, how they look in Coot.</p>
</section>
<section id="symmetry-expansion">
<h3>Symmetry expansion.<a class="headerlink" href="#symmetry-expansion" title="Link to this heading"></a></h3>
<p>As mentioned above, <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> outputs are always in spacegroup P1. This means that the only relevant symmetry operation is the periodic boundary condition. But there is a catch - even though your map is always in P1, your structural model is unlikely to be! PyMOL looks for symmetry operations wherever it can find them. This means that if <code class="docutils literal notranslate"><span class="pre">map_auto_expand_sym</span></code> is on, and you use the <code class="docutils literal notranslate"><span class="pre">isomesh</span></code> command as such:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">isomesh</span> <span class="n">my_new_mesh</span><span class="p">,</span> <span class="n">map_from_matchmaps</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pdb_in_high_symmetry_spacegroup</span> <span class="ow">and</span> <span class="n">resi</span> <span class="mi">20</span>
</pre></div>
</div>
<p>then the map produced will be expanded by a series of nonsense symmetry operators that in no way apply!</p>
<p>There are two potential successful approaches:</p>
<ol class="arabic simple">
<li><p>If you only wish to visualize density <em>inside</em> the unit cell, you’re in luck! You can just turn off symmetry expansion (<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">map_auto_expand_sym,</span> <span class="pre">off</span></code>) and this will work just fine.</p></li>
<li><p>If the region you would like to visualize does <em>not</em> lie inside the unit cell, then you will need to make a copy of your <code class="docutils literal notranslate"><span class="pre">.pdb</span></code> file in which you coerce the spacegroup to P1. (I usually just do this in a text editor; there are many possible approaches to this.) Then, (with <code class="docutils literal notranslate"><span class="pre">map_auto_expand_sym</span></code> set to <code class="docutils literal notranslate"><span class="pre">on</span></code>!) PyMOL should render periodic boundaries as desired, without any spurious symmetry operations.</p></li>
</ol>
<p>Hopefully this is useful! If you have any questions about <code class="docutils literal notranslate"><span class="pre">matchmaps</span></code> and PyMOL, please reach out, and I will try to be helpful as best I can!</p>
</section>
<section id="pymol-wiki-pages-for-the-commands-mentioned">
<h3><a class="reference external" href="https://pymolwiki.org/index.php/Main_Page">PyMOL Wiki</a> pages for the commands mentioned<a class="headerlink" href="#pymol-wiki-pages-for-the-commands-mentioned" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://pymolwiki.org/index.php/Load"><code class="docutils literal notranslate"><span class="pre">load</span></code></a></p></li>
<li><p><a class="reference external" href="https://pymolwiki.org/index.php/Isomesh"><code class="docutils literal notranslate"><span class="pre">isomesh</span></code></a></p></li>
<li><p><a class="reference external" href="https://pymolwiki.org/index.php/Normalize_ccp4_maps"><code class="docutils literal notranslate"><span class="pre">normalize_ccp4_maps</span></code></a></p></li>
<li><p><a class="reference external" href="https://pymolwiki.org/index.php/Map_auto_expand_sym"><code class="docutils literal notranslate"><span class="pre">map_auto_expand_sym</span></code></a></p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cli.html" class="btn btn-neutral float-left" title="matchmaps command-line interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="about.html" class="btn btn-neutral float-right" title="About the matchmaps algorithm" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Dennis Brookner.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>